{% extends 'base.html' %}
{% load i18n %}

{% block title %}AirSense - {% trans 'Weather & Pollen Tracker' %}{% endblock %}

{% block extra_css %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
    <div class="container">
        <h1>AirSense</h1>
        <p data-translate="Weather & Pollen Tracker">Weather & Pollen Tracker</p>
        
        <div class="weather-section">
            <h2 data-translate="Weather Forecast">Weather Forecast</h2>
            
            <div class="city-search">
                <div class="city-input-container">
                    <input type="text" id="cityInput" placeholder="Enter city name..." data-translate="Enter city name...">
                    <div id="cityDropdown" class="city-dropdown"></div>
                </div>
                <button id="searchCity" data-translate="Search">Search</button>
                <span id="selectedCity"></span>
            </div>
            
            <div id="currentCityName"></div>
            
            <div class="current-weather">
                <button id="tempToggle" class="temp-toggle">째F</button>
                <div id="current-temp">--째C</div>
                <div id="current-condition">Loading...</div>
                <div id="current-humidity">Humidity: --%</div>
            </div>
            
            <div class="day-selector">
                <div class="day-bar" id="dayBar"></div>
            </div>
            
            <div class="daily-weather">
                <div id="daily-temp">Max: --째C | Min: --째C</div>
                <div id="daily-condition">--</div>
            </div>
            
            <div class="hourly-weather">
                <h3 data-translate="Hourly Forecast">Hourly Forecast</h3>
                <table id="hourly-table">
                    <thead>
                        <tr>
                            <th data-translate="Hour">Hour</th>
                            <th data-translate="Temperature">Temperature</th>
                            <th data-translate="Humidity">Humidity</th>
                            <th data-translate="Wind Speed">Wind Speed</th>
                            <th data-translate="Condition">Condition</th>
                        </tr>
                    </thead>
                    <tbody id="hourly-container"></tbody>
                </table>
                <div class="weather-chart-controls">
                    <label><input type="checkbox" id="temperature-chart" checked> Temperature</label>
                    <label><input type="checkbox" id="humidity-chart"> Humidity</label>
                    <label><input type="checkbox" id="windspeed-chart"> Wind Speed</label>
                </div>
                <div class="weather-chart">
                    <canvas id="weatherChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="pollen-forecast-section">
            <h2 data-translate="Pollen Forecast">Pollen Forecast</h2>
            
            <div class="pollen-controls">
                <input type="date" id="pollenDateSelect">
                <div class="pollen-day-bar" id="pollenDayBar"></div>
            </div>
            
            <div class="hourly-pollen">
                <h3 data-translate="Hourly Pollen Forecast">Hourly Pollen Forecast</h3>
                <table id="pollen-hourly-table">
                    <thead>
                        <tr>
                            <th data-translate="Hour">Hour</th>
                            <th data-translate="Alder">Alder</th>
                            <th data-translate="Birch">Birch</th>
                            <th data-translate="Grass">Grass</th>
                            <th data-translate="Mugwort">Mugwort</th>
                            <th data-translate="Olive">Olive</th>
                            <th data-translate="Ragweed">Ragweed</th>
                        </tr>
                    </thead>
                    <tbody id="pollen-hourly-container"></tbody>
                </table>
                <div class="pollen-type-selector">
                    <label><input type="checkbox" id="alder-chart" checked> Alder</label>
                    <label><input type="checkbox" id="birch-chart" checked> Birch</label>
                    <label><input type="checkbox" id="grass-chart" checked> Grass</label>
                    <label><input type="checkbox" id="mugwort-chart" checked> Mugwort</label>
                    <label><input type="checkbox" id="olive-chart" checked> Olive</label>
                    <label><input type="checkbox" id="ragweed-chart" checked> Ragweed</label>
                </div>
                <div class="pollen-chart">
                    <canvas id="pollenChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="pollen-section">
            <h2 data-translate="Pollen Allergies">Pollen Allergies</h2>
            <form id="pollenForm">
                <div class="pollen-checkboxes">
                    <label><input type="checkbox" name="pollens" value="alder" {% if 'alder' in user_allergies %}checked{% endif %}> <span data-translate="Alder Pollen">Alder Pollen</span></label>
                    <label><input type="checkbox" name="pollens" value="birch" {% if 'birch' in user_allergies %}checked{% endif %}> <span data-translate="Birch Pollen">Birch Pollen</span></label>
                    <label><input type="checkbox" name="pollens" value="grass" {% if 'grass' in user_allergies %}checked{% endif %}> <span data-translate="Grass Pollen">Grass Pollen</span></label>
                    <label><input type="checkbox" name="pollens" value="mugwort" {% if 'mugwort' in user_allergies %}checked{% endif %}> <span data-translate="Mugwort Pollen">Mugwort Pollen</span></label>
                    <label><input type="checkbox" name="pollens" value="olive" {% if 'olive' in user_allergies %}checked{% endif %}> <span data-translate="Olive Pollen">Olive Pollen</span></label>
                    <label><input type="checkbox" name="pollens" value="ragweed" {% if 'ragweed' in user_allergies or not user.is_authenticated %}checked{% endif %}> <span data-translate="Ragweed Pollen">Ragweed Pollen</span></label>
                </div>
            </form>
        </div>
        
        <div class="feeling-section">
            <h2 data-translate="How do you feel today?">How do you feel today?</h2>
            <form id="feelingForm">
                {% csrf_token %}
                <textarea id="feelingText" placeholder="Describe how you feel today..." data-translate="Describe how you feel today..."></textarea>
                <button type="submit" data-translate="Submit">Submit</button>
            </form>
            <div id="sentimentResult"></div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
    <script>
        const weatherData = {{ weather_data|safe }};
        const pollenData = {{ pollen_data|safe }};
        const currentLat = {{ lat }};
        const currentLon = {{ lon }};
        const userAuthenticated = {{ user.is_authenticated|yesno:"true,false" }};
    </script>
    <script src="/static/core/js/home.js"></script>
{% endblock %}